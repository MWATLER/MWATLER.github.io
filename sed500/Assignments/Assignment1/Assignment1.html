<h1>Assignment 1 - Analog Circuit Simulator</h1>

<p><b>Due - End of week 7</b></p>

<p>This is a group project of 2 or 3 students per group. The groups can be found in the document 
    <a href="Assignment1_Groups.docx" target="_blank">Assignment1_Groups.docx</a>. Each group will 
    also be assigned a page on Teams so you can work together online.</p>

<h2>Introduction</h2>

<p>Work on an analog circuit simulator has been started by a former employee and you are asked to take over. You must 
    consider the theoretical background of the work, and the completion of the design and implementation that was in progress.
</p>

<h2>Theoretical Background</h2>

<p>There are three approaches to analog circuit simulation: numerical methods, machine learning, and heuristic algorithms. Each is described below.</p>

<h3>Numerical Methods for the Solution of Analog Electronic Circuits</h3>

<p>Simulation is a very important part of design. Most hardware projects undergo rigorous simulations before 
    implementation actually occurs. Simulating the behaviour of an analog circuit is quite simple. One can 
    simply obtain the differential equation for the circuit, and use well known numerical methods to solve them.</p>

<p>Several numerical algorithms are well know. Below is a summary of a few:
<ul>
<li><b>Euler's method.</b> The Euler method (also called forward Euler method) is a first-order numerical procedure 
    for solving ordinary differential equations with a given initial value. It is the most basic explicit 
    method for numerical integration of ordinary differential equations. The Euler method is a first-order method, 
    which means that the local error (error per step) is proportional to the square of the step size, and the global 
    error (error at a given time) is proportional to the step size. The Euler method often serves as the basis to 
    construct more complex methods. One way to think about Euler's method is that it uses the
    derivative at the current solution point (t0, u0) to create a linear prediction of the solution at the next time t1. </li>
<li><b>Midpoint method.</b> The midpoint method tries for an improved prediction over the Euler's method. It does this
    by taking an initial half step in time, sampling the derivative there, and then using that forward information as the slope.
    In other words, it replaces the tangent line by a line that is starting to bend correctly.</li>
<li><b>Runge-Kutta method.</b> One of the standard workhorses for solving ordinary differential equations is the called the Runge-Kutta 
    method. This method is simply a higher order approximation to the midpoint method. Instead of shooting to the midpoint, estimating 
    the derivative, the shooting across the entire interval - the Runge-Kutta method, in a sense takes, four steps, shooting
    across one quarter of the interval, estimating the derivative, then shooting to the midpoint, and so on. The precise
    manner in which the method propagates across a time step is done in the optimal way for the four steps</li>
</ul>
For more details, see the publication <a href="NumericalMethods.pdf" target="_blank">Numerical Methods for Differential Equations</a>.
</p>

<p>The problem of applying well known numerical methods to solving analog electronic circuits is that these methods assume 
    linear behaviour. The key point that distinguishes a nonlinear circuit from a linear circuit is the relationship between 
    the input and output signal. If you graph the output signal versus the input signal for a linear circuit, then the graph 
    will be a straight line for all input signal levels. With a nonlinear circuit, the output will not be a straight line. 
    Instead, the output will be a curve.</p>

<p>It is likely that all the circuits you built were linear circuits, meaning they only contained resistors, capacitors, and non-ferritic 
    inductors. While this is a great way to get an important introduction into the fundamentals of basic circuits, almost all modern 
    circuits contain many more complicated elements and functionality. For a discussion of linear and nonlinear circuits, see 
    <a href="https://resources.pcb.cadence.com/blog/2019-the-basics-of-linear-vs-nonlinear-circuits" target="_blank">The Basics of Linear vs. Nonlinear Circuits</a>.
</p>

<p>To summarize, linear devices include resistors, capacitors, and most inductors when driven with low current.
    Nonlinear devices include semiconductor devices (transistors and diodes), ferrite inductors driven at high 
    current where magnetic saturation occurs, all amplifiers, and almost all integrated circuits. Therefore, for 
    non-linear circuits, we cannot rely on numerical methods and we have to take another approach.</p>

<h3>The Machine Learning Cost Function</h3>

<p>The machine learning cost function attempts to approximate real data with a hypothetical equation. Let us say we 
wish to approximate data with a first order function:<br>
h<sub>&#952;</sub>(x) = &#952;<sub>0</sub> + &#952;<sub>1</sub> x<br>
The parameters we want to guess are &#952;<sub>0</sub> and &#952;<sub>1</sub>. We generate a cost function that determines the difference 
between actual data and this approximation by taking the square of the difference between the points. We choose 
&#952;<sub>0</sub> and &#952;<sub>1</sub> to minimize this difference. This is summarized below:<br><br>
<img src="CostFunction.jpg" alt="The Cost Function" width="500" height="200"></img>
</p>

<p>It is possible to apply the machine learning cost function to non-linear electronic circuits if we expand 
    h<sub>&#952;</sub>(x) to a much higher order equation. For instance:<br>
h<sub>&#952;</sub>(x) = &#952;<sub>0</sub> + &#952;<sub>1</sub> x + &#952;<sub>2</sub> x<sup>2</sup> + &#952;<sub>2</sub> x<sup>3</sup> ...<br><br>
We could apply voltages to the circuits and measure the currents we seek, determine the optimum &#952;'s, and use that to predict behaviour.
</p>

<h3>Heuristic Algorithms for the Solution of Analog Electronic Circuits</h3>

<p>A heuristic algorithm is one that is designed to solve a problem in a faster and more efficient fashion than traditional methods by sacrificing 
   optimality, accuracy, precision, or completeness for speed. Heuristic algorithms often times used to solve NP-complete problems, a class of 
   decision problems. In these problems, there is no known efficient way to find a solution quickly and accurately although solutions can be 
   verified when given. Heuristics can produce a solution individually or be used to provide a good baseline and are supplemented with optimization 
   algorithms. Heuristic algorithms are most often employed when approximate solutions are sufficient and exact solutions are necessarily computationally 
   expensive.</p>

<p>For a linear electronic circuit, a heuristic algorithm is not required, since all voltages and currents through the circuit can be solved using 
    numerical analysis. For non-linear circuits, a heuristic approach is required. Consider the diode. The voltage current relationship is given as:<br>
    <b>i(v) = I<sub>S</sub>[e<sup>(v/(&#951;V<sub>T</sub>))</sup>-1]</b>, v>V<sub>Z</sub><br>
    where I<sub>S</sub> is the reverse saturation current,<br>
    v is the applied voltage (reverse bias is negative),<br>
    V<sub>T</sub>=T/11,586 is the volt equivalence of temperature, and<br>
    &#951; is the emission coefficient, which is 1 for germanium devices and 2 for silicon devices.<br><br>
    Note that for v&leq;V<sub>Z</sub>, the diode is in breakdown and the ideal diode no longer applies.<br><br>
    The ideal diode i-v characteristic curve is shown below:<br><br>
<img src="DiodeEquation.jpg" alt="The Diode Equation"></img><br><br>

Sometimes the inverse relation is more useful, and that is the voltage across a diode as a function of the current:<br>
v(i) = &#951;V<sub>T</sub>ln[(i/I<sub>S</sub>)+1]
</p>

<p>There are many other non-linear circuit components. For instance, the transistor, the operational amplifier, any magnetic circuit where magnetic 
    saturation occurs. In fact, such simple components such as the resistor, capacitor and inductor exhibit non-linear behaviour if they are pushed 
    to their limits.</p>

<h2>The Work Breakdown</h2>

<p>There are several parts to assignment 1. First is the cost function, which is used to guess the current for a particular instant in time. The second 
are the circuit components, the third is the graphics.</p>

<h3>The Cost Function</h3>

<p>Assignment 1 revolves around a cost function. This is a function that tries to predict the currents of the components given 
    the applied voltage. The cost function sums the voltages of the components and compares to the applied voltage. The "cost" is the 
    difference between the applied voltage and the sum of the voltages across the components. Several iterations are taken until the cost 
    is below a tolerance level, which is typically very low. The following variables are used:
<ul>
<li><b>I1</b> is the predicted current. Several iterations are required to approach the correct current.</li>
<li><b>J1</b> is the cost of the function for the current iteration. We try to reduce this to zero or close to zero.</li>
<li><b>J0</b> is the cost of the function for the previous iteration. We use both J1 and J0 to predict the current.</li>
<li><b>voltage</b> is the voltage applied across the circuit.</li>
<li><b>sumVoltage</b> is the voltage summed across all component for a given current I1.</li>
</ul>
As you can see from the above, the idea is to repetitively guess <b>I1</b> such that the cost <b>J1</b> (sumVoltage-voltage) approaches zero.
</p>

<h3>The Circuit Components</h3>

<p>Some files have been given to you. You can change these. The component class, which acts as a base class for all circuit components, 
    is given to you. Each component will display its current in a different colour, and each component has a name. There are pure virtual 
    functions which require implementation in derived classes. The header file for the analog circuit has been given to you. This class 
    contains a list of circuit components, a static display function which can be called from all of its components, a run function for 
    when you want to run the actual simulation, the cost function as described above, and a destructor. Some function implementations 
    have been given in the CPP file for the analog circuit. Finally, a main function has been provided in full. See all files at:<br>
    <a href="release/Component.h" target="_blank">Component.h</a>, (complete)<br>
    <a href="release/AnalogCircuit.h" target="_blank">AnalogCircuit.h</a>, (complete)<br>
    <a href="release/AnalogCircuit.cpp" target="_blank">AnalogCircuit.cpp</a> (incomplete) and<br>
    <a href="release/AnalogCircuitMain.cpp" target="_blank">AnalogCircuitMain.cpp</a> (complete).
</p>

<p>The analog circuit used in this assignment does not have non-linear components, but can be used to verify the functionality of your software. We will 
    apply a sinusoidal voltage for 0.6 seconds, then 0 volts for the remainder of the simulation. The circuit looks as follows:<br>
    <img src="RLC.png" alt="RLC Circuit" width="500" height="200"></img><br><br>
    Recall from your physics and electronics classes, the voltages as a function of current across these components are as follows:
<ul>
    <li><b>Resistor:</b> V<sub>R</sub>(t) = i R</li>
    <li><b>Inductor:</b> V<sub>L</sub>(t) = L di/dt</li>
    <li><b>Capacitor:</b> V<sub>C</sub>(t) = V<sub>0</sub> + 1/C <span style='font-size:20px;'>&int;</span>i dt</li>
</ul>
</p>

By using a small time-step, the above equations can be approximated using Euler's method as follows:
<ul>
    <li><b>The Resistor</b>. The resistor has a resistance in Ohms as well as a current running through it. The voltage across a resistor is simply 
        the current going through the resistor times the resistance:<br>
        <b>voltage = current * resistance</b>.</li>    
    <li><b>The Inductor</b>. An inductor has an inductance in Henries and has current running through it in Amperes. If a current is applied to the inductor, 
        the voltage across the inductor is given as follows:<br>
        <b>voltage = inductance * (current[1] - current[0]) / timestep</b>, where current[1] is the applied current and current[0] is the current from the previous time step.<br>
        Once the correct current has been determined, don't forget to update your current: current[1] = current[0].<br>
    <li><b>The Capacitor</b>. The capacitor has a capacitance in Farads, a current running through it in Amperes, and a voltage stored in it in Volts. If a current is 
        applied to the capacitor, the voltage across the capacitor is as follows:<br>
        <b>voltage[1] = voltage[0] + current * timestep / capacitance</b>, where voltage[1] is the current voltage and voltage[0] is the voltage from the previous time step.<br>
        Once the correct current has been determined, don't forget to update your voltage: voltage[1] = voltage[0].<br>
</ul>

<h3>The Graphics</h3>

<p>The graphics library suggested for this assignment is OpenGL. The following link explains how to add OpenGL to Visual Studio:<br>
<a href="https://content.byui.edu/file/2315e65e-a34a-48d3-814d-4175a2b74ed5/1/intro/165-opengl-visualStudio2017.html" target="_blank">Configuring Visual Studio for OpenGL Development</a>.</p>
<p>To summarize:
    <ul>
        <li>Create a project.</li>
        <li>Right-click on "References", then click on Manage Nuget Packages.</li>
        <li>Select Package Manager Console.</li>
        <li>Click on the prompt (where it says PM>), and type: Install-Package nupengl.core Then press enter.</li>
    </ul>
A manual of OpenGL API's can be found at:
<a href="http://code.nabla.net/doc/OpenGL/index.html" target="_blank">OpenGL Documentation</a>.
</p>

<h2>Summary of Tasks</h2>

For this assignment, you must complete the following tasks and answer the following questions:
<ul>
<li>You must provide a project plan by the end of the fourth week.</li>
<li>You must provide a working prototype by the end of the fourth week.</li>
<li>The project consists of three parts. You must have all parts working by the end of the assignment.
<ul>
    <li>Familiarize yourself with the graphics library.</li>
    <li>Complete the classes for the Inductor, Capacitor and Resistor.</li>
    <li>Complete the function implementations of the AnalogCircuit class.</li>
</ul>
</li>
</ul>

<p>The questions comprise a large portion of this assignment. Here you must show me that you can analyze the project and make suggestions for improvements.</p>

<ol>
<li>You may notice that the cost function is based on Euler's method. What other method(s) might be applied to enable it to run more efficiently?</li>
<li>You may notice that the cost function has no intelligence. It does not learn. This heuristic algorithm does not comply 
    with the principles of machine learning. How might you add intelligence to our cost function to enable it to run more efficiently?</li>
<li>Devise a completely different way to implement the cost function. Is there some quicker way of guessing the present current knowing the previous voltage and current?</li>
<li>You may not like the way this project was designed and implemented. What changes would you suggest and why (ie. graphics, circuit components, using C++, ...).</li>
</ol>

<h2>Marking Rubric</h2>

<style>
    table, th, td {
      border: 1px solid black;
    }
    table {
        width: 800;
    }
    </style>
    <table>
        <tr><th></th><th>Does not meet expectations</th><th>Satisfactory</th><th>Good</th><th>Exceeds Expectations</th></tr>
        <tr><td><b>The Project Plan<br>(3 marks)</b></td><td>Does not meet requirements</td><td>Meets the most important requirements</td><td>Meets all requirements with minor errors</td><td>Meets all requirements with no errors</td></tr>
        <tr><td><b>The Prototype<br>(1 mark)</b></td><td>Does not meet requirements</td><td>Meets the most important requirements</td><td>Meets all requirements with minor errors</td><td>Meets all requirements with no errors</td></tr>
        <tr><td><b>The Graphics Library<br>(2 marks)</b></td><td>Does not meet requirements</td><td>Meets the most important requirements</td><td>Meets all requirements with minor errors</td><td>Meets all requirements with no errors</td></tr>
        <tr><td><b>The Component Classes<br>(2 marks)</b></td><td>Does not meet requirements</td><td>Meets the most important requirements</td><td>Meets all requirements with minor errors</td><td>Meets all requirements with no errors</td></tr>
        <tr><td><b>The Analog Circuit Class<br>(2 marks)</b></td><td>Does not meet requirements</td><td>Meets the most important requirements</td><td>Meets all requirements with minor errors</td><td>Meets all requirements with no errors</td></tr>
        <tr><td><b>Code Documentation<br>(1 mark)</b></td><td>Does not contain documentation</td><td>Contains header documentation for either all files or for all functions within each file</td>
            <td>Contains header documentation for all files and for most functions within each file</td><td>Contains header documentation for all files and for all functions within each file.
                Documents unclear code.</td></tr>
        <tr><td><b>Questions<br>(4 marks)</b></td><td>Answers no question correctly</td><td>Answers some questions correctly</td>
            <td>Answers most questions correctly</td><td>Answers all Questions correctly</td></tr>
    </table>
    
<h2><b><u>Submission</u></b></h2>
    
    <p>Please email all source code and answers to questions to:
        <a href="mailto: miguel.watler@senecacollege.ca">miguel.watler@senecacollege.ca</a></p>
    
    <p>Your answers to questions can be submitted in a separate document or embedded within your source code.</p>
    
<h2><b><u>Late Policy</u></b></h2>
    
    <p>You will be docked 10% if your assignment is submitted 1-2 days late.<br>
       You will be docked 20% if your assignment is submitted 3-4 days late.<br>
       You will be docked 30% if your assignment is submitted 5-6 days late.<br>
       You will be docked 40% if your assignment is submitted 7 days late.<br>
       You will be docked 50% if your assignment is submitted over 7 days late.</p>
    