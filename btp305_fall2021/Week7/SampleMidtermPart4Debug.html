<!DOCTYPE html []>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="author" content="MarkdownViewer++" />
    <title>Sample — Midterm Part 4 — Debug.md</title>
    <style type="text/css">
            
/* Avoid page breaks inside the most common attributes, especially for exports (i.e. PDF) */
td, h1, h2, h3, h4, h5, p, ul, ol, li {
    page-break-inside: avoid; 
}

        </style>
  </head>
  <body>
    <h1 id="description-for-students">Description for Students</h1>
    <p>This is a sample <strong>Part #4</strong> of the Midterm test. This sample test doesn’t contribute in any way to your mark. This sample test is designed as an example of the <strong>type of question</strong> you will have and the procedure to deliver your answer; it is not an indication of the difficulty of the question or the concepts being tested.</p>
    <p>In this part you must identify syntactic errors in C++ code, according to the C++17 standard.</p>
    <h1 id="instructions-for-students">Instructions for Students</h1>
    <p>The <strong>Debugging</strong> questions are presented as C++ code that has errors in it: errors caught by a compiler, generate memory leaks or crashes/undefined behaviour at runtime.  Your task is to identify each error by file name and line number and <strong>to explain why the error appears, what C++ standard rule is broken or C++ feature is misused and how to fix the error</strong>.  Your answer will be evaluated based on <strong>clarity of the text</strong> and the show of <strong>understanding of the concepts</strong> involved.</p>
    <p>Each identified error can receive 4 points:</p>
    <ul>
      <li>
        <strong>1 point</strong>: a brief description that shows the error was correctly identified</li>
      <li>
        <strong>2 points</strong>: a detailed description that shows a deep understanding of the problem and concepts involved</li>
      <li>
        <strong>1 point</strong>: a fix that completely solves the problem (might require changes in multiple places)</li>
    </ul>
    <p>Trivial answers, brief answers, or compiler messages do not show an understanding of the concepts and receive 0 points. Examples of insufficient/incomplete answers:</p>
    <ul>
      <li>"Line <code>X</code> is not correct."</li>
      <li>"You are not allowed to write code like on line <code>X</code>."</li>
      <li>"You should replace line <code>X</code> with ..."</li>
    </ul>
    <p>Once you start the test, the timer begins; if you exit or get disconnected you must reconnect immediately not to lose time. If you remain disconnected, your test will be submitted after the timer reaches the end of the duration of the test.</p>
    <h2 id="plagiarism">Plagiarism</h2>
    <p>You are allowed to use any tool and material available to you during the test. The following are considered plagiarism:</p>
    <ul>
      <li>exchanging messages in any form with another person during the test.</li>
      <li>allowing access to your questions/solutions to somebody else before the test due date.</li>
      <li>acquiring the test questions/solutions that somebody else had before the test due date.</li>
    </ul>
    <h2 id="suggestions">Suggestions</h2>
    <p>Look carefully at every line in the code snippet you are provided.  Ask yourself <em>"For this line to work, what conditions must be met?"</em>, and then check that those conditions are met. Example of conditions (the list below is general and not complete, just gives you some examples):</p>
    <ul>
      <li>identifiers are declared/defined</li>
      <li>necessary headers are included</li>
      <li>types match in the expression</li>
      <li>keywords are used with the correct semantic</li>
      <li>operators and language features are used following the C++ standard</li>
      <li>correct namespaces are used</li>
      <li>null terminator for strings is used appropriately</li>
      <li>privacy rules are not violated</li>
      <li>variables are not used before being initialized</li>
      <li>dynamic memory is correctly handled</li>
      <li>inheritance/polymorphism rules are followed correctly</li>
      <li>templates use correct template parameters when instantiated</li>
    </ul>
    <h1 id="sample-question-1">Sample Question #1</h1>
    <p>The code below contains <strong>five</strong> (5) syntactic errors under C++17 standard (errors that are caught by a compiler or generate crashes/undefined behaviour at runtime).</p>
    <pre>
      <code class="language-cpp">01. // A.h
02. #ifndef A_H
03. #define A_H
04.
05. struct A
06. {
07. public:
08.     double m_val;
09. public:
10.     A operator+=(const A&amp; other)
11.     {
12.         this-&gt;m_val += other.m_val;
13.         return *this;
14.     }
15.     double getValue() const { return m_val; }
16. };
17.
18. decltype(A().getValue()) operator+=(double&amp; val, const A&amp; other);
19.
20. // "data" is an array of "N" elements of type "T"
21. template &lt;typename T, double N&gt;
22. T process(const T* data)
23. {
24.     T sum{};
25.     for (const auto&amp; elem : data)
26.         sum += elem;
27.     return sum;
28. }
29. #endif
</code>
    </pre>
    <pre>
      <code class="language-cpp">01. // A.cpp
02. #include "A.h"
03.
04. decltype(A().getValue()) operator+=(double&amp; val, const A&amp; other)
05. {
06.     return val += other.getValue();
07. }
</code>
    </pre>
    <pre>
      <code class="language-cpp">01. // main.cpp
02. #include &lt;iostream&gt;
03. #include "A.h"
04. using namespace std;
05.
06. int main()
07. {
08.     int arrI[5]{ 0, 1, 2, 3, 4, 5 };
09.     cout &lt;&lt; process(arrI) &lt;&lt; endl;
10.
11.     A arrA[5]{ {1.2}, {2.3}, {3.4}, {4.5} };
12.     cout &lt;&lt; process(arrA) &lt;&lt; endl;
13. }
</code>
    </pre>
    <p>Your task is to identify each one by the file name and line number and <strong>explain why the error appears, what C++ standard rule is broken, what C++ feature is misused and how the error should be fixed</strong>.  Your answer will be evaluated based on <strong>clarity of the text</strong> and the show of <strong>understanding of the concepts</strong> that are involved in the error.</p>
    <p>Write in the answer box your solution, using the following template:</p>
    <pre>
      <code class="language-txt">Error 1:



Error 2:



Error 3:



Error 4:



Error 5:



</code>
    </pre>
    <h1 id="how-to-answer">How to Answer</h1>
    <h2 id="test-question">Test Question</h2>
    <p>The code below contains <strong>one</strong> (1) syntactic errors under C++17 standard (that is caught by a compiler, generate memory leaks or crashes/undefined behaviour at runtime).</p>
    <pre>
      <code class="language-cpp">01. // utilities.h
02. namespace utilities
03. {
04.     enum class Color
05.     {
06.         Red,
07.         Green,
08.         Blue,
09.         Yellow,
10.         Magenta,
11.         Purple,
12.     };
13. }
</code>
    </pre>
    <pre>
      <code class="language-cpp">01. // car.h
02. #include "utilities.h"
03. using namespace utilities;
04. 
05. namespace work
06. {
07.     class Car
08.     {
09.         Color m_color = Color::Red;
10.     public:
11.         // other members
12.     };
13. }
</code>
    </pre>
    <pre>
      <code class="language-cpp">01. // main.cpp
02. #include &lt;string&gt;
03. #include &lt;iostream&gt;
04. #include &lt;iomanip&gt;
05. #include "car.h"
06. 
07. // stores a color in RGB format
08. struct Color
09. {
10.     unsigned short red;
11.     unsigned short green;
12.     unsigned short blue;
13. };
14. 
15. // Print a color using a the format #RRGGBB
16. void print(Color aColor)
17. {
18.     std::cout &lt;&lt; "#" &lt;&lt; std::hex &lt;&lt; std::setfill('0')
19.               &lt;&lt; std::setw(2) &lt;&lt; aColor.red
20.               &lt;&lt; std::setw(2) &lt;&lt; aColor.green
21.               &lt;&lt; std::setw(2) &lt;&lt; aColor.blue
22.               &lt;&lt; std::setfill(' ') &lt;&lt; std::dec;
23. }
24. 
25. int main()
26. {
27.     // ... use the Car type, do some things
28.     Color col{ 255, 0, 0 };
29.     std::cout &lt;&lt; "I want to use the color ";
30.     print(col);
31.     // ... do some other things
32. }
</code>
    </pre>
    <p>Your task is to identify the error by the file name and line number and <strong>explain why the error appears, what C++ standard rule is broken, what C++ feature is misused and how the error should be fixed</strong>.  Your answer will be evaluated based on <strong>clarity of the text</strong> and the show of <strong>understanding of the concepts</strong> that are involved in the error.</p>
    <p>Write in the answer box your solution, using the following template:</p>
    <pre>
      <code class="language-txt">Error 1:
    Error Identification:  
    Detailed Description: 
    Fix:
</code>
    </pre>
    <h3 id="sample-answer">Sample Answer</h3>
    <p>
      <em>(1 point)</em>
      <strong>Error:</strong>
      <em>main.cpp:16</em> The parameter's type of the function <code>print</code> is ambiguous.</p>
    <p>
      <em>(2 points)</em>
      <strong>Detailed Description:</strong>  Adding <code>using namespace ...</code> in headers is considered a bad practice because it can generate hard to find/hard to fix errors.  Because headers get included in other files, any statement from a header will be included.  Headers should not contain statements that could have side-effects in the modules that include them.</p>
    <p>In this example, the file <code>main.cpp</code> defines the <code>Color</code> structure in the global namespace.  This module also includes <code>car.h</code>, which includes <code>utilities.h</code>, which defines the enumeration <code>Color</code> in the namespace <code>utilities</code>.  In main module we have defined two types named <code>Color</code>: the enumeration and the structure.  This shouldn't be a problem because each type is defined in a different namespace; however, since the header <code>car.h</code> contains the statement <code>using namespace utilities;</code>, that is also include in <code>main.cpp</code>, and the compiler cannot uniquely identify which type <code>Color</code> must be used for the <code>print</code> parameter. This results in a compilation error.</p>
    <p>
      <em>(1 point)</em>
      <strong>Fix:</strong>  Remove <code>using namespace utilities;</code> from the header <code>car.h:3</code>.  In <code>car.h</code> use <code>utilities::Color</code> when needed to use the type <code>Color</code>: <code>utilities::Color m_color = utilities::Color::Red;</code>.</p>
    <h2 id="test-question-1">Test Question</h2>
    <p>The code below contains <strong>one</strong> (1) syntactic errors under C++17 standard (that is caught by a compiler, generate memory leaks or crashes/undefined behaviour at runtime).</p>
    <pre>
      <code class="language-cpp">01. #include &lt;iostream&gt;
02. #include &lt;string&gt;
03. 
04. class A
05. {
06. public:
07.   void displayA() const { std::cout &lt;&lt; "A\n"; }
08. };
09. 
10. class B : public A
11. {
12.   std::string m_name = "John";
13. public:
14.   void displayB() const { std::cout &lt;&lt; "B: " &lt;&lt; m_name &lt;&lt; '\n'; }
15. };
16. 
17. class C : public A
18. {
19.   int m_data = 10;
20. public:
21.   void displayC() const { std::cout &lt;&lt; "C: " &lt;&lt; m_data &lt;&lt; '\n'; }
22. };
23. 
24. int main()
25. {
26.   /// Version 1
27.   {
28.     A* theA = new C;
29.     B* theB = static_cast&lt;B*&gt;(theA);
30.     theB-&gt;displayB();
31.     delete theA;
32.   }
33. 
34.   /// Version 2
35.   //{
36.   //  C theC;
37.   //  B* theB = (B*)(&amp;theC);
38.   //  theB-&gt;displayB();
39.   //}
40. }
</code>
    </pre>
    <p>Your task is to identify the error by the file name and line number and <strong>explain why the error appears, what C++ standard rule is broken, what C++ feature is misused and how the error should be fixed</strong>.  Your answer will be evaluated based on <strong>clarity of the text</strong> and the show of <strong>understanding of the concepts</strong> that are involved in the error.</p>
    <p>Write in the answer box your solution, using the following template:</p>
    <pre>
      <code class="language-txt">Error 1:
    Error Identification:  
    Detailed Description: 
    Fix:
</code>
    </pre>
    <h3 id="sample-answer-1">Sample Answer</h3>
    <p>
      <em>(1 point)</em>
      <strong>Error:</strong>
      <em>(main.cpp:29)</em> In the main function, an incorrect casting operator is used on line <code>B* theB = static_cast&lt;B*&gt;(theA)</code>, generating a runtime crash.</p>
    <p>
      <em>(2 points)</em>
      <strong>Detailed Description:</strong>  The <code>static_cast</code> operator should be used only for types that are compatible with each-other (between numerical fundamental types, or custom types that define a casting operator/constructor).  The conversion is checked at compile time.</p>
    <p>In the code above, the conversion might succeed, but might also NOT succeed: at compile-time there is not enough information to make the determination if the <strong>actual</strong> type of the object whose address is stored in <code>theA</code> pointer can be converted to <code>B</code>.  The <code>static_cast</code> operator only checks if there is a compatibility between declared types: <code>A</code> vs <code>B</code>.</p>
    <p>When converting between types on the same hierarchy we should use <code>dynamic_cast</code>. This operator is evaluated at runtime, and will check if the <strong>actual</strong> type of the object whose address is stored in <code>theA</code> can be converted to <code>B</code>.  If the conversion is not possible, this operator returns <code>nullptr</code>.</p>
    <p>
      <em>(1 point)</em>
      <strong>Fix:</strong> Replace the casting operator with <code>dynamic_cast</code>; on the next line, before using <code>theB</code>, check if the conversion was successful:</p>
    <pre>
      <code class="language-cpp">B* theB = dynamic_cast&lt;B*&gt;(theA);
if (nullptr != theB)
  theB-&gt;display();
</code>
    </pre>
    <p>
      <strong>Obs:</strong> If the function <code>B::displayB()</code> would not use any attribute, the code would seem to run correctly, keeping the bug hidden.</p>
    <p>
      <strong>Obs:</strong> Similar error with the cast in <em>main.cpp:37</em>.</p>
  </body>
</html>
