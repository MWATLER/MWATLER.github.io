//SimpleFile.cpp - Performs File I/O
//
// 18-Jan-19  M. Watler         Created.

#include <iostream>
#include <stdio.h>
#include <sys/time.h>

using namespace std;

int main()
{
    FILE *fpIn=NULL;
    FILE *fpOut=NULL;
    int c;
    double elapsedTime;
    int rc=0;

    char inFile[] = "/home/miguelwatler/src/Week2/speedTest/LargeFOpen.txt";
    char outFile[]= "/home/miguelwatler/src/Week2/speedTest/LargeFOpenCopy.txt";
    const long nanosecsPerSecond=1000000000;

    fpIn = fopen(inFile, "r");
    fpOut = fopen(outFile, "w");
    if(fpIn==NULL) {
       cout << "Error opening " << inFile << endl;
       rc=-1;
    }
    if(rc==0) {
        if(fpOut==NULL) {
            cout << "Error opening " << outFile << endl;
            fclose(fpIn);
            rc=-1;
        }
    }

    if(rc==0) {
        timespec ts1, ts2;
        clock_gettime(CLOCK_REALTIME, &ts1);
        do {
            c = fgetc(fpIn);
            fputc(c, fpOut);
        } while (c!=EOF);
        clock_gettime(CLOCK_REALTIME, &ts2);
        elapsedTime = (double)(ts2.tv_sec-ts1.tv_sec)*nanosecsPerSecond + (ts2.tv_nsec-ts1.tv_nsec);
        elapsedTime /= nanosecsPerSecond;
        cout << "The elapsed time with fopen is " << elapsedTime << "seconds" << endl;

        fclose(fpIn);
        fclose(fpOut);
        cout << "DONE" << endl;
    }

    return rc;
}
